<!DOCTYPE HTML>
<html>
  <head>
    <title>Chomson's United: Andrew and Jenny are getting married!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Andrew and Jenny are getting married!">
    <meta name="author" content="Andrew Thomson">
    <script src="assets/js//jquery-1.7.2.min.js"></script>
    <script>window.jQuery || document.write('<script src="assets/js/jquery-1.7.2.min.js"><\/script>')</script>
    <script src="assets/js/jquery-ui-1.8.22.custom.min.js"></script>
    <script src="assets/js/jquery.imagesloaded.min.js"></script>
    <script src="assets/js/modernizr-2.5.3.min.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyB2_fDpWOUX-_CfICIz9zUdhKjZkCDcVig&sensor=false"></script>
    <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:200' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="assets/css/main.css" rel="stylesheet">

    <!-- IE Fix for HTML5 Tags -->
    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body onload="initialize_map()">

    <!-- Navbar -->
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand scroller" data-section="html" href="index.html">CHOMSONS UNITED</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              <li><a href="#" class="scroller" data-section="#address_container">RSVP</a></li>
              <li><a href="#" class="scroller" data-section="#map">Map</a></li>
              <li><a href="#" class="scroller" data-section="#team">The Team</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- end Navbar -->

    <!-- #main-container -->
    <div class="main-container">

      <!-- #intro -->
      <div class="container-fluid" id="intro">
        <div class="container">
          <div class="row">
            <div class="span5 offset6">
              <h1>Andrew and Jenny are getting married!</h1>
              <h2>August 8th 2015<br>5:30 pm Gilroy, CA</h2>
            </div>
          </div>
        </div>
      </div>
      <!-- ends Intro -->

      <!-- #rsvp -->
      <div class="container-fluid" id="address_container">
        <div class="container dark">
          <h2>RSVP</h2>
          <div id="success_message" class="row" style="display:none;">
            <div class="span12">
              <h3>Yay! Thank you</h3>
            </div>
          </div>

          <div id="rsvp_box" class="row">
            <div class="span5 offset1">
              <form id="rsvp_form" name="rsvp" action="https://chomsonforms.s3.amazonaws.com/" method="post" enctype="multipart/form-data">
                <input type="hidden" name="key" id="rsvp_key" value="rsvp/test_stuff"> <!-- TODO HACK THIS -->
                <input type="hidden" name="AWSAccessKeyId" value="AKIAJ4NGYR7BDC7CHQVA">
                <input type="hidden" name="acl" value="private">
                <input type="hidden" name="success_action_redirect" value="success.html">
                <input type="hidden" name="policy" value="eyJleHBpcmF0aW9uIjogIjIwMTYtMDEtMDFUMDA6MDA6MDBaIiwKICAiY29uZGl0aW9ucyI6IFsKICAgIHsiYnVja2V0IjogImNob21zb25mb3JtcyJ9LAogICAgWyJzdGFydHMtd2l0aCIsICIka2V5IiwgInJzdnAvIl0sCiAgICB7ImFjbCI6ICJwcml2YXRlIn0sCiAgICB7InN1Y2Nlc3NfYWN0aW9uX3JlZGlyZWN0IjogInN1Y2Nlc3MuaHRtbCJ9LAogICAgWyJjb250ZW50LWxlbmd0aC1yYW5nZSIsIDAsIDEwNDg1NzZdCiAgXQp9Cg==">
                <input type="hidden" name="signature" value="AGmvSkZNiH1zSjogqMRDYjr1OBI=">
                <input id='rsvp_file' name="file" type="hidden">
                <div class="control-group">
                  <div class="controls">
                    TODO: [slider for attending, not-attending]
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label" for="Name">Name(s)</label>
                  <div class="controls">
                    <input type="text" class="span4 guest_name" id="name1" placeholder="First and Last"></br>
                    <button type="add" id="add_button" class="btn btn-peach" data-num-guests=1>Add guest</button>
                  </div>
                </div>
                <div class="control-group">
                  <div class="controls">
                    <textarea id="diet_restrictions" placeholder="Please enter dietary restrictions here." rows="3" class="span4"></textarea>
                  </div>
                </div>
                <div class="control-group">
                  <div class="controls">
                    <button type="submit" id="rsvp_button" class="btn btn-blue">Submit</button>
                  </div>
                </div>
              </form>
            </div>

            <div class="span5">
              <p>Please let us know if you are coming! Thank you!</p>
            </div>
          </div>
        </div>
      </div>
      <!-- End rsvp -->

      <!-- #map -->
      <div class="container-fluid" id="map">
        <div class="container light">
          <h2>Map</h2>
          <div class="span8" id="map_place"></div>
          <div class="span2">
            <a href="https://www.google.com/maps/dir//3255+Day+Rd,+Gilroy,+CA+95020/@37.0470922,-121.651969,17z/data=!4m13!1m4!3m3!1s0x808e1fb592efe30d:0x1e152417d3749b2e!2s3255+Day+Rd,+Gilroy,+CA+95020!3b1!4m7!1m0!1m5!1m1!1s0x808e1fb592efe30d:0x1e152417d3749b2e!2m2!1d-121.651969!2d37.0470922"><h3>Directions</h3>Kirigin Cellars<br>3255 Day Road, Gilroy, CA 95020</a>
            <br><br>
            (408) 847-8827
          </div>
        </div>
      </div>
      <!-- ends map-->

      <!-- #team -->
      <div class="container-fluid" id="team">
        <div class="container dark">
          <h2>Meet the team</h2>
          <ul class="thumbnails">

            <li class="span4">
              <div class="thumbnail">
                <img alt="" src="assets/img/andrew_yellow.jpg">
                <h3>Andrew</h3>
                <p>The Hacker</p>
              </div>
            </li>

            <li class="span4">
              <div class="thumbnail">
                <img alt="" src="assets/img/ramen_cool.jpg">
                <h3>Ramen</h3>
                <p>The Mastermind</p>
              </div>
            </li>

            <li class="span4">
              <div class="thumbnail">
                <img alt="" src="assets/img/jenny_yellow.jpg">
                <h3>Jenny</h3>
                <p>The Muscle</p>
              </div>
            </li>

          </ul>
        </div>
      </div>
      <!-- End Team -->

    </div> <!-- end main-container -->

    <script>
      $(function () {
        $(window).scroll(function(){
          // global scroll to top button
          if ($(this).scrollTop() > 300) {
            $('.scrolltop').fadeIn();
          } else {
            $('.scrolltop').fadeOut();
          }
        });

        // scroll nav
        $('.scroller').click(function(){
          var section = $($(this).data("section"));
          var top = section.offset().top-82;
          $("html, body").animate({ scrollTop: top }, 700);
          return false;
        });
      });
    </script>
    <script type="text/javascript">
      function uuid() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
          return v.toString(16);
        });
      }

      function initialize_map() {
        var options = {
          center: new google.maps.LatLng(37.046447,-121.652471),
          zoom: 12,
          mapTypeId: "Watercolor",
          mapTypeControlOptions: {
            mapTypeIds: ["Watercolor", google.maps.MapTypeId.ROADMAP,]
          },
          panControl: false,
          zoomControl: false,
          mapTypeControl: true,
          scaleControl: false,
          streetViewControl: false,
          overviewMapControl: false,
          scrollwheel: false,
        };
        var map = new google.maps.Map(document.getElementById("map_place"), options);
        var address = "Kirigin Cellars, 3255 Day Road, Gilroy, CA";
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode( { 'address': address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            map.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
        map.mapTypes.set("Watercolor", new google.maps.StamenMapType("watercolor"));
      }

      $('#rsvp_button').on('click', function (e) {
        e.preventDefault();
        var doc = {};

        $('.guest_name').each(function () {
          id = $(this).attr('id');
          doc[id] = $('#' + id).val();
        });

        doc['diet_restrictions'] = $('#diet_restrictions').val();
        doc_str = JSON.stringify(doc)
        doc_key = "rsvp/" + uuid()
        $('#rsvp_file').val(doc_str)
        $('#rsvp_key').val(doc_key)
        $('#rsvp_form').submit()
        $('#rsvp_box').hide("blind");
        $('#success_message').show("blind");
        console.log(doc_key + " -> " + doc_str)
      });

      $('#add_button').on('click', function (e) {
        e.preventDefault();
        num_guests = $(this).data('num-guests') + 1
        new_guest = "<span id='name_row" + num_guests.toString() + "'>" +
        "<input type='text' class='span4 guest_name' id='name" + num_guests.toString() + "' placeholder='First and Last'>" +
        "<button type='remove' class='btn btn-peach remove_button' data-row-id='name_row" + num_guests.toString() + "'>-</button></br></span>"
        $(this).before(new_guest)
        $(this).data('num-guests', num_guests)
        loadRemoveButton();
      });

      function loadRemoveButton() {
        $('.remove_button').on('click', function (e) {
          row = "#" + $(this).data('row-id')
          $(row).remove();
        });
      }

    </script>
  </body>
</html>
